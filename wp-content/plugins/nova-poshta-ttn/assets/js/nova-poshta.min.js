jQuery(document).ready(function(){function e(){var e={action:"my_actionfogetnpshippngcost",c2:jQuery("#billing_nova_poshta_city").val(),cod:jQuery("#payment_method_cod").attr("checked")};jQuery.post(NovaPoshtaHelper.ajaxUrl,e,function(e){jQuery("#shipcost").remove(),e.includes("01234")||0==e||jQuery(".order-total").after('<tr id=shipcost class=order-total><th>Розрахунок вартості доставки</th><td><strong><span class="woocommerce-Price-currencySymbol">₴</span>'+e+'<strong><input type="hidden" name=deliveryprice value="'+e+'"/ ></td></tr>')})}if(document.getElementById("billing_nova_poshta_city")){jQuery.post(NovaPoshtaHelper.ajaxUrl,{action:"novaposhta_updbasesnp"},function(e){}),setTimeout(function(){jQuery("#billing_country").trigger("change",[])},500),jQuery("#billing_nova_poshta_city").change(function(){e(),city=jQuery("#billing_nova_poshta_city").val(),document.cookie="city="+city}),jQuery("body").on("click",".wc_payment_method",function(){setTimeout(function(){e()},20),setTimeout(function(){e()},500),setTimeout(function(){e()},4e3)}),jQuery("body").on("click",".shipping_method",function(){console.log(jQuery(this).val()),"nova_poshta_shipping_method"==jQuery(this).val()?(e(),setTimeout(function(){e()},500),setTimeout(function(){e()},4e3)):jQuery("#shipcost").remove()});var o={minimumInputLength:2,language:{errorLoading:function(){return"Завантаження."},inputTooShort:function(){return"Введіть більше символів..."},noResults:function(){return"Нічого не знайдено"},searching:function(){return"Пошук…"}}};document.getElementById("billing_nova_poshta_region")?(jQuery("#billing_nova_poshta_city").select2(),jQuery("#shipping_nova_poshta_city").select2(),jQuery("#billing_nova_poshta_warehouse").select2(),jQuery("#shipping_nova_poshta_warehouse").select2(),jQuery("#billing_nova_poshta_region").on("change",function(){jQuery("#billing_nova_poshta_city").select2({sorter:function(e){return e.sort(function(o,n){let t=jQuery(".select2-search__field");if(0===t.length||""===t.val())return e;let i=o.text.toLowerCase(),a=n.text.toLowerCase(),s=t.val().toLowerCase();return i.indexOf(s)<a.indexOf(s)?-1:i.indexOf(s)>a.indexOf(s)?1:0}),e}}),jQuery("#billing_nova_poshta_warehouse").select2("val","")}),jQuery("#billing_nova_poshta_city").on("change",function(){jQuery("#billing_nova_poshta_warehouse").select2("val","")}),jQuery("#shipping_nova_poshta_region").on("change",function(){jQuery("#shipping_nova_poshta_city").select2({sorter:function(e){return e.sort(function(o,n){let t=jQuery(".select2-search__field");if(0===t.length||""===t.val())return e;let i=o.text.toLowerCase(),a=n.text.toLowerCase(),s=t.val().toLowerCase();return i.indexOf(s)<a.indexOf(s)?-1:i.indexOf(s)>a.indexOf(s)?1:0}),e}}),jQuery("#shipping_nova_poshta_warehouse").select2("val","")}),jQuery("#shipping_nova_poshta_city").on("change",function(){jQuery("#shipping_nova_poshta_warehouse").select2("val","")})):(jQuery("#billing_nova_poshta_city").select3(o),jQuery("#shipping_nova_poshta_city").select3(o),jQuery("#billing_nova_poshta_warehouse").select3(),jQuery("#shipping_nova_poshta_warehouse").select3(),jQuery("#billing_nova_poshta_region").on("change",function(){jQuery("#billing_nova_poshta_city").select3("val",""),jQuery("#billing_nova_poshta_warehouse").select3("val","")}),jQuery("#billing_nova_poshta_city").on("change",function(){jQuery("#billing_nova_poshta_warehouse").select3("val","")}),jQuery("#shipping_nova_poshta_region").on("change",function(){jQuery("#shipping_nova_poshta_city").select3("val",""),jQuery("#shipping_nova_poshta_warehouse").select3("val","")}),jQuery("#shipping_nova_poshta_city").on("change",function(){jQuery("#shipping_nova_poshta_warehouse").select3("val","")}))}var n=function(e){var o={},n=e("#billing_nova_poshta_region, #billing_nova_poshta_city, #billing_nova_poshta_warehouse"),t=e("#billing_nova_poshta_region"),i=e("#billing_nova_poshta_city"),a=e("#billing_nova_poshta_warehouse"),s=e("#shipping_nova_poshta_region, #shipping_nova_poshta_city, #shipping_nova_poshta_warehouse"),r=e("#shipping_nova_poshta_region"),c=e("#shipping_nova_poshta_city"),l=e("#shipping_nova_poshta_warehouse"),p=e("#billing_address_1, #billing_address_2, #billing_city, #billing_state, #billing_postcode"),h=e("#shipping_address_1, #shipping_address_2, #shipping_city, #shipping_state, #shipping_postcode"),_=e("input[name^=shipping_method]"),u=e("#ship-to-different-address-checkbox"),d=function(){if(!"nova_poshta_shipping_method".includes(g())){(g()||"1").includes("npttn_address_shipping_method")?(e("#billing_address_2_field").attr("disabled","disabled").css("display","none"),e("#billing_state_field").attr("value","_").css("display","none"),e("#billing_postcode_field").attr("disabled","disabled").css("display","none"),e("#billing_address_1").removeAttr("disabled").css("display","block").closest(".form-row").show(),e("#billing_city").removeAttr("disabled").css("display","block").closest(".form-row").show()):p.each(function(){e(this).removeAttr("disabled").closest(".form-row").show()})}},v=function(){"nova_poshta_shipping_method".includes(g())&&p.each(function(){e(this).attr("disabled","disabled").closest(".form-row").hide()})},g=function(){var o=e("input[name^=shipping_method][type=radio]:checked").val();return o||(o=e("input#shipping_method_0").val()),o||(o=e("input[name^=shipping_method][type=hidden]").val()),o},f=function(){h.each(function(){e(this).removeAttr("disabled").closest(".form-row").show()})},y=function(){h.each(function(){e(this).attr("disabled","disabled").closest(".form-row").hide()})},m=function(){n.each(function(){e(this).attr("disabled","disabled").closest(".form-row").hide()}),d(),s.each(function(){e(this).attr("disabled","disabled").closest(".form-row").hide()}),f()},b=function(){var o;m(),(o=e("input[name^=shipping_method][type=radio]:checked").val())||(o=e("input#shipping_method_0").val()),o||(o=e("input[name^=shipping_method][type=hidden]").val()),o||e.post(NovaPoshtaHelper.ajaxUrl,{action:"my_action_for_wc_get_chosen_method_ids"},function(e){o=e}),e("#billing_country").val()&&"UA"!=e("#billing_country").val()||o&&"nova_poshta_shipping_method"!==o||(u.is(":checked")?(s.each(function(){e(this).removeAttr("disabled").closest(".form-row").show()}),v(),y()):(n.each(function(){e(this).removeAttr("disabled").closest(".form-row").show()}),v()))};return o.init=function(){e(document).on("change",_,function(){b()}),e(document).on("change",u,function(){b()}),e(document.body).bind("updated_checkout",function(){b()}),b(),t.on("change",function(){var o=this.value;e.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getCitiesAction,parent_ref:o},success:function(o){try{var n=JSON.parse(o);i.find("option:not(:first-child)").remove(),e.each(n,function(o,n){i.append(e("<option></option>").attr("value",o).text(n))}),a.find("option:not(:first-child)").remove()}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})}),i.on("change",function(){var o=this.value;e.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getWarehousesAction,parent_ref:o},success:function(o){try{var n=JSON.parse(o);a.find("option:not(:first-child)").remove(),e.each(n,function(o,n){a.append(e("<option></option>").attr("value",o).text(n))})}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})}),r.on("change",function(){var o=this.value;e.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getCitiesAction,parent_ref:o},success:function(o){try{var n=JSON.parse(o);c.find("option:not(:first-child)").remove(),e.each(n,function(o,n){c.append(e("<option></option>").attr("value",o).text(n))}),l.find("option:not(:first-child)").remove()}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})}),c.on("change",function(){var o=this.value;e.ajax({url:NovaPoshtaHelper.ajaxUrl,method:"POST",data:{action:NovaPoshtaHelper.getWarehousesAction,parent_ref:o},success:function(o){try{var n=JSON.parse(o);l.find("option:not(:first-child)").remove(),e.each(n,function(o,n){l.append(e("<option></option>").attr("value",o).text(n))})}catch(e){console.log("Error. Response from server was: "+o)}},error:function(){console.log("Error.")}})})},o}(jQuery),t=function(e){var o={},n=function(){var o=e("input[name^=shipping_method][type=radio]:checked").val();return o||(o=e("input#shipping_method_0").val()),"nova_poshta_shipping_method"===o},t=function(){e("#calc_shipping_country").find("option").each(function(){"UA"!==e(this).val()&&e(this).remove()}),e("#calc_shipping_state_field").hide();var o=e('<input type="hidden" id="calc_nova_poshta_shipping_method" value="nova_poshta_shipping_method" name="shipping_method">'),n=e('<input type="hidden" id="calc_nova_poshta_shipping_city" name="calc_nova_poshta_shipping_city">');e("#calc_shipping_city_field").append(n).append(o);var t=e("#calc_shipping_city");t.autocomplete({source:function(o,n){e.ajax({type:"POST",url:NovaPoshtaHelper.ajaxUrl,data:{action:NovaPoshtaHelper.getCitiesByNameSuggestionAction,name:o.term},success:function(o){var t=JSON.parse(o);n(e.map(t,function(e,o){return{label:e,value:o}}))}})},focus:function(e,o){return t.val(o.item.label),!1},select:function(e,o){return t.val(o.item.label),n.val(o.item.value),!1}}),e("form.woocommerce-shipping-calculator").on("submit",function(){if("UA"!==e("#calc_shipping_country").val())return!1})};return o.init=function(){e(document.body).bind("updated_wc_div updated_shipping_method",function(){n()&&t()}),n()&&t()},o}(jQuery);n.init(),t.init()});
